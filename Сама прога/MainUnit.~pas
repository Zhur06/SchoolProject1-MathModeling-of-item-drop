unit MainUnit;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, Menus, StdCtrls, ComCtrls, ExtCtrls;

type
  Pic = class
  public
    v: integer;
    al: integer;
    m: integer;
    k: integer;
    color: TColor;
  end;

  TMainForm = class(TForm)
    GroupBox1: TGroupBox;
    OpenDialog1: TOpenDialog;
    SaveDialog1: TSaveDialog;
    PageControl1: TPageControl;
    TabSheet2: TTabSheet;
    Edit2: TEdit;
    Edit3: TEdit;
    TabSheet4: TTabSheet;
    Edit15: TEdit;
    Edit16: TEdit;
    Edit17: TEdit;
    Edit18: TEdit;
    GroupBox2: TGroupBox;
    GroupBox3: TGroupBox;
    Label1: TLabel;
    ComboBox1: TComboBox;
    GroupBox5: TGroupBox;
    Label2: TLabel;
    Label3: TLabel;
    GroupBox6: TGroupBox;
    Label4: TLabel;
    Label5: TLabel;
    Label6: TLabel;
    Label7: TLabel;
    ColorDialog1: TColorDialog;
    GroupBox10: TGroupBox;
    Label8: TLabel;
    RunBtn: TButton;
    Button1: TButton;
    Panel1: TPanel;
    ScaleCB: TCheckBox;
    GroupBox4: TGroupBox;
    SaveToFileBtn: TButton;
    ReadFromFileBtn: TButton;
    procedure SaveToFileBtnClick(Sender: TObject);
    procedure ReadFromFileBtnClick(Sender: TObject);
    procedure RunBtnClick(Sender: TObject);
    procedure ComboBox1Change(Sender: TObject);
    procedure Button1Click(Sender: TObject);
    procedure ScaleCBClick(Sender: TObject);
  private
    { Private declarations }
    procedure RePaint();
    procedure Draw2();
    procedure Draw5();
    procedure ReadFromFile2();
    procedure SaveToFile2();
    procedure ReadFromFile5();
    procedure SaveToFile5();
  public
    pictureA: array of Pic;
    CF2, CF5: integer;
    ChoozedColor: TColor;
    { Public declarations }
  end;

var
  MainForm: TMainForm;

implementation

uses IniFiles, ChildUnit2, ChildUnit5;

{$R *.dfm}

//----------------- Выбор модели -----------------------------------------------

procedure TMainForm.ComboBox1Change(Sender: TObject);
begin
  case ComboBox1.ItemIndex of
    0: PageControl1.ActivePage := TabSheet2;
    1: PageControl1.ActivePage := TabSheet4;
  end;
end;

//################# ВТОРОЙ РИСУНОК #############################################


//----------------- Черчение рисунка -------------------------------------------

procedure TMainForm.Draw2();
begin
  SetLength(pictureA, length(pictureA) + 1);
  pictureA[length(pictureA) - 1] := Pic.Create;

  pictureA[length(pictureA) - 1].V := StrToIntDef(Edit2.Text, 0);
  pictureA[length(pictureA) - 1].al := StrToIntDef(Edit3.Text, 0);

  pictureA[length(pictureA) - 1].Color := ChoozedColor;

  if CF2 = 0 then
  begin
    ChildForm2 := TChildForm2.Create(Self);                                     //Создание самой формы
    CF2 := CF2 + 1;
  end
  else
  begin
    ChildForm2.PaintBox1Paint(Self);
  end;
end;

//----------------- Считывание данных для второго рисунка из файла -------------

procedure TMainForm.ReadFromFile2();
var ini: TIniFile;
begin
  if OpenDialog1.Execute then
  begin
    ini := TIniFile.Create(OpenDialog1.FileName);
    try
      Edit2.Text := IntToStr(ini.ReadInteger('2', 'v', 0));
      Edit3.Text := IntToStr(ini.ReadInteger('2', 'al', 0));
    finally
      ini.Free;
    end;
  end;
end;

//----------------- Сохранение данных второго рисунка в файл -------------------

procedure TMainForm.SaveToFile2();
var ini: TIniFile; strV, strAl: string; c: integer;
begin
  strV := Edit2.Text;                                                           //Проверка что в поле для ввода скорости пользователь ввел число
  for c:=1 to length(strV) do
  begin
    if not (strV[c] in ['0'..'9']) then
    begin
      Edit2.Text := 'You have typed something that was not a number';
      EXIT;
    end;
  end;

  strAl := Edit3.Text;                                                          //Проверка что в поле для ввода угла пользователь ввел число
  for c:=1 to length(strAl) do
  begin
    if not (strAl[c] in ['0'..'9']) then
    begin
      Edit3.Text := 'You have typed something that was not a number';
      EXIT;
    end;
  end;

  if SaveDialog1.Execute then                                                   //Перенос значений в файл
  begin
    ini := TIniFile.Create(SaveDialog1.FileName);
    ini.WriteInteger('2', 'v', StrToInt(strV));
    ini.WriteInteger('2', 'al', StrToInt(strAl));
  end;
end;

//################# ПЯТЫЙ РИСУНОК ##############################################


//----------------- Черчение Рисунка -------------------------------------------

procedure TMainForm.Draw5();
begin
  SetLength(pictureA, length(pictureA) + 1);
  pictureA[length(pictureA) - 1] := Pic.Create;

  pictureA[length(pictureA) - 1].V := StrToIntDef(Edit15.Text, 0);
  pictureA[length(pictureA) - 1].al := StrToIntDef(Edit16.Text, 0);
  pictureA[length(pictureA) - 1].m := StrToIntDef(Edit17.Text, 0);
  pictureA[length(pictureA) - 1].k := StrToIntDef(Edit18.Text, 0);

  pictureA[length(pictureA) - 1].Color := ChoozedColor;

  if CF5 = 0 then
  begin
    CF5 := CF5 + 1;
    ChildForm5 := TChildForm5.Create(Self);
  end
  else
    ChildForm5.PaintBox1Paint(Self);
end;

//----------------- Считывание данных для пятого рисунка из файла --------------

procedure TMainForm.ReadFromFile5();
var ini: TIniFile;
begin
  if OpenDialog1.Execute then
  begin
    ini := TIniFile.Create(OpenDialog1.FileName);
    try
      Edit15.Text := IntToStr(ini.ReadInteger('2', 'v', 0));
      Edit16.Text := IntToStr(ini.ReadInteger('2', 'al', 0));
      Edit17.Text := IntToStr(ini.ReadInteger('2', 'm', 0));
      Edit18.Text := IntToStr(ini.ReadInteger('2', 'k', 0));
    finally
      ini.Free;
    end;
  end;
end;

//----------------- Сохранение данных пятого рисунка в файл --------------------

procedure TMainForm.SaveToFile5();
var ini: TIniFile; v, al, m, k: integer;
begin
  v := StrToIntDef(Edit15.Text, 0);
  if v = 0 then
  begin
    ShowMessage('Некорректное значение в поле скорости !');
    EXIT;
  end;

  al := StrToIntDef(Edit16.Text, 0);
  if al = 0 then
  begin
    ShowMessage('Некорректное значение в поле угла !');
    EXIT;
  end;

  m := StrToIntDef(Edit17.Text, 0);
  k := StrToIntDef(Edit18.Text, 0);

  if SaveDialog1.Execute then                                                   //Перенос значений в файл
  begin
    ini := TIniFile.Create(SaveDialog1.FileName);
    ini.WriteInteger('2', 'v', v);
    ini.WriteInteger('2', 'al', al);
    ini.WriteInteger('2', 'm', m);
    ini.WriteInteger('2', 'k', k);
  end;
end;

//----------------- Перерисовка ------------------------------------------------

procedure TMainForm.RePaint();
begin
  if CF2 > 0 then
    ChildForm2.PaintBox1Paint(Self);

  if CF5 > 0 then
    ChildForm5.PaintBox1Paint(Self);
end;

//----------------- Выбор Цвета ------------------------------------------------

procedure TMainForm.Button1Click(Sender: TObject);
begin
  if ColorDialog1.Execute then
    ChoozedColor := ColorDialog1.Color;
  Panel1.Color := ChoozedColor;
end;

//----------------- Масштабирование --------------------------------------------

procedure TMainForm.ScaleCBClick(Sender: TObject);
begin
  RePaint();
end;

//----------------- Отрисовка Графиков -----------------------------------------

procedure TMainForm.RunBtnClick(Sender: TObject);
begin
  case ComboBox1.ItemIndex of
    0: Draw2;
    1: Draw5;
  end;
end;

//----------------- Сохранение/Чтение в/из файл(а) -----------------------------

procedure TMainForm.SaveToFileBtnClick(Sender: TObject);
begin
  case ComboBox1.ItemIndex of
    0: SaveToFile2;
    1: SaveToFile5;
  end;
end;

procedure TMainForm.ReadFromFileBtnClick(Sender: TObject);
begin
  case ComboBox1.ItemIndex of
    0: ReadFromFile2;
    1: ReadFromFile5;
  end;
end;

end.
